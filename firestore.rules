
{
  "rules": {
    "users": {
      "$uid": {
        ".read": "request.auth != null && (request.auth.uid == $uid || (get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'teacher' && resource.data.teacherId == request.auth.uid)) || resource.data.role == 'teacher'",
        ".write": "request.auth != null && request.auth.uid == $uid"
      }
    },
    "assessments": {
      "$assessmentId": {
        ".read": "request.auth != null && (resource.data.teacherId == request.auth.uid || request.auth.uid in resource.data.assignedStudentIds)",
        ".write": "request.auth != null && resource.data.teacherId == request.auth.uid"
      }
    },
    "submissions": {
      "$submissionId": {
        ".read": "request.auth != null && (resource.data.teacherId == request.auth.uid || resource.data.studentId == request.auth.uid)",
        ".write": "request.auth != null && (resource.data.studentId == request.auth.uid || resource.data.teacherId == request.auth.uid)"
      }
    },
    "content": {
      "$contentId": {
        ".read": "request.auth != null && (request.auth.uid == resource.data.teacherId || request.auth.uid in resource.data.assignedStudentIds)",
        ".write": "request.auth != null && request.auth.uid == resource.data.teacherId"
      }
    },
    "assignments": {
      "$assignmentId": {
        ".read": "request.auth.uid == resource.data.teacherId || request.auth.uid == resource.data.studentId",
        ".write": "request.auth.uid == resource.data.teacherId"
      }
    },
    "game_sessions": {
      "$sessionId": {
        ".read": "request.auth.uid == resource.data.studentId || get(/databases/$(database)/documents/assignments/$(resource.data.assignmentId)).data.teacherId == request.auth.uid",
        ".write": "request.auth.uid == resource.data.studentId"
      }
    }
  }
}
